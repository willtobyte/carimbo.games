<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Play NES Emulator - Carimbo Game" />
    <meta name="keywords" content="Game Engine, WebAssembly, C++, SDL, Lua, Carimbo, NES, Emulator" />
    <meta name="author" content="Rodrigo Delduca" />
    <title>NES Emulator - Carimbo</title>
    <link rel="preload" href="./carimbo.js" as="script" />
    <style>
      *, *::before, *::after { box-sizing: border-box; }
      body { margin: 0; font-family: "Segoe UI", Ubuntu, "Helvetica Neue", sans-serif; }
      main { display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
      .container { width: 1280px; max-width: 100vw; aspect-ratio: 16 / 9; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }
      #canvas { width: 100%; height: 100%; display: block; opacity: 0; animation: fade 1s ease forwards; }
      #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: rgba(255, 255, 255, 0.8); padding: 8px 12px; border-radius: 4px; }
      @keyframes fade { from { opacity: 0; } to { opacity: 1; } }
      .about { font-size: 14px; line-height: 1.4; text-align: left; width: 100%; max-width: 1080px; margin-top: 16px; }
      @media only screen and (max-width: 414px) { .about { padding: 16px; } }
      @media only screen and (min-width: 1024px) { .about { width: 1280px; margin: 8px 0 16px calc((100vw - 1280px) / 2); text-align: left; align-self: flex-start; } }
    </style>
  </head>
  <body>
    <main>
      <div class="container">
        <canvas id="canvas"></canvas>
        <div id="loading" style="display: none">This is taking a little longer than expected</div>
      </div>
      <div class="about">
        <h1><strong>NES Emulator</strong></h1>
        <p>A Nintendo Entertainment System emulator running Donkey Kong.</p>
        <h2>How to Play</h2>
        <p>Use the arrow keys to move and Z/X for buttons.</p>
        <p>Powered by <a href="https://github.com/willtobyte/carimbo">Carimbo</a>.</p>
        <p>Check out the <strong>source code</strong> on <a href="https://github.com/willtobyte/NES">GitHub</a>.</p>
      </div>
    </main>
    <script type="module">
      const canvas = document.getElementById("canvas");
      const [romResponse, nesResponse] = await Promise.all([
        fetch("./cartridge.rom"),
        fetch("./donkeykong.nes")
      ]);
      const bundle = await romResponse.arrayBuffer();
      const nesRom = await nesResponse.arrayBuffer();
      const loading = document.getElementById("loading");
      const timer = setTimeout(() => { loading.style.display = "block"; }, 500);
      window.Module = {
        canvas,
        noInitialRun: true,
        locateFile: (path) => { if (path.endsWith(".wasm")) { return "./" + path; } },
        onRuntimeInitialized: () => {
          clearTimeout(timer);
          loading.style.display = "none";
          FS.writeFile("/cartridge.rom", new Uint8Array(bundle));
          FS.writeFile("/donkeykong.nes", new Uint8Array(nesRom));
          console.log("Files written:", FS.readdir("/"));
          Module.callMain();
        },
      };
      const script = document.createElement("script");
      script.src = "./carimbo.js";
      script.defer = true;
      document.head.appendChild(script);
    </script>
  </body>
</html>
